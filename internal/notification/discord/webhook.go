package discord

import (
	"fmt"
	"strings"
	"time"

	"github.com/assist-by/phoenix/internal/notification"
)

// SendSignalì€ ì‹œê·¸ë„ ì•Œë¦¼ì„ ì „ì†¡í•©ë‹ˆë‹¤
// func (c *Client) SendSignal(signal notification.Signal) error {
// 	embed := NewEmbed().
// 		SetTitle(fmt.Sprintf("íŠ¸ë ˆì´ë”© ì‹œê·¸ë„: %s", signal.Symbol)).
// 		SetDescription(fmt.Sprintf("**íƒ€ì…**: %s\n**ê°€ê²©**: $%.2f\n**ì´ìœ **: %s",
// 			signal.Type, signal.Price, signal.Reason)).
// 		SetColor(getColorForSignal(signal.Type)).
// 		SetFooter("Assist by Trading Bot ğŸ¤–").
// 		SetTimestamp(signal.Timestamp)

// 	msg := WebhookMessage{
// 		Embeds: []Embed{*embed},
// 	}

// 	return c.sendToWebhook(c.signalWebhook, msg)
// }

// SendErrorëŠ” ì—ëŸ¬ ì•Œë¦¼ì„ ì „ì†¡í•©ë‹ˆë‹¤
func (c *Client) SendError(err error) error {
	embed := NewEmbed().
		SetTitle("ì—ëŸ¬ ë°œìƒ").
		SetDescription(fmt.Sprintf("```%v```", err)).
		SetColor(notification.ColorError).
		SetFooter("Assist by Trading Bot ğŸ¤–").
		SetTimestamp(time.Now())

	msg := WebhookMessage{
		Embeds: []Embed{*embed},
	}

	return c.sendToWebhook(c.errorWebhook, msg)
}

// SendInfoëŠ” ì¼ë°˜ ì •ë³´ ì•Œë¦¼ì„ ì „ì†¡í•©ë‹ˆë‹¤
func (c *Client) SendInfo(message string) error {
	embed := NewEmbed().
		SetDescription(message).
		SetColor(notification.ColorInfo).
		SetFooter("Assist by Trading Bot ğŸ¤–").
		SetTimestamp(time.Now())

	msg := WebhookMessage{
		Embeds: []Embed{*embed},
	}

	return c.sendToWebhook(c.infoWebhook, msg)
}

// SendTradeInfoëŠ” ê±°ë˜ ì‹¤í–‰ ì •ë³´ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤
func (c *Client) SendTradeInfo(info notification.TradeInfo) error {
	embed := NewEmbed().
		SetTitle(fmt.Sprintf("ê±°ë˜ ì‹¤í–‰: %s", info.Symbol)).
		SetDescription(fmt.Sprintf(
			"**í¬ì§€ì…˜**: %s\n**ìˆ˜ëŸ‰**: %.8f %s\n**í¬ì§€ì…˜ í¬ê¸°**: %.2f USDT\n**ë ˆë²„ë¦¬ì§€**: %dx\n**ì§„ì…ê°€**: $%.2f\n**ì†ì ˆê°€**: $%.2f\n**ëª©í‘œê°€**: $%.2f\n**í˜„ì¬ ì”ê³ **: %.2f USDT",
			info.PositionType,
			info.Quantity,
			strings.TrimSuffix(info.Symbol, "USDT"), // BTCUSDTì—ì„œ BTCë§Œ ì¶”ì¶œ
			info.PositionValue,
			info.Leverage,
			info.EntryPrice,
			info.StopLoss,
			info.TakeProfit,
			info.Balance,
		)).
		SetColor(notification.GetColorForPosition(info.PositionType)).
		SetFooter("Assist by Trading Bot ğŸ¤–").
		SetTimestamp(time.Now())

	msg := WebhookMessage{
		Embeds: []Embed{*embed},
	}

	return c.sendToWebhook(c.tradeWebhook, msg)
}
